<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    
    
        
            
                <link rel="shortcut icon" href="/images/favicon.ico">
            
        
        
            
                <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
            
        
        
            
                <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
            
        
    
    <!-- title -->
    <title>docker go</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC&display=swap" rel="stylesheet">
    <link href="https://cdn.staticfile.org/firacode/6.2.0/fira_code.min.css" rel="stylesheet">
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 7.1.1"></head>

<body class="max-width mx-auto px3 ltr">

    <div id="header-post">
    <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
    <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
    <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i
                class="fas fa-chevron-up fa-lg"></i></a>
    <span id="menu">
    <span id="nav">
      <ul>
          
              <li><a href="/">Home</a></li>
          
              <li><a href="/archives/">Articles</a></li>
          
              <li><a href="/categories/">Category</a></li>
          
              <li><a href="/tags/">Tag</a></li>
          
              <li><a href="/about/">About</a></li>
          
              <li><a href="/search/">Search</a></li>
          
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
          
              <li><a class="icon" href="/2021/04/09/%E5%B0%8F%E7%9F%A5%E8%AF%86/vue%E5%B0%8F%E7%9F%A5%E8%AF%86/"><i class="fas fa-chevron-left"
                                                                           aria-hidden="true"
                                                                           onmouseover="$('#i-prev').toggle();"
                                                                           onmouseout="$('#i-prev').toggle();"></i></a></li>
          
          
              <li><a class="icon" href="/2020/10/11/%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95/%E5%80%BCor%E5%BC%95%E7%94%A8%E4%B9%8B%E4%BA%8C--%E5%A0%86%E4%B8%8E%E6%A0%88/"><i class="fas fa-chevron-right"
                                                                           aria-hidden="true"
                                                                           onmouseover="$('#i-next').toggle();"
                                                                           onmouseout="$('#i-next').toggle();"></i></a></li>
          
          <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i
                          class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();"
                          onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true"
                                        onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();"
                                        onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
    <li><a class="icon"
           target="_blank" rel="noopener" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/&title=docker go"><i
                    class="fab fa-qq " aria-hidden="true"></i></a></li>
    <li><a class="icon"
           target="_blank" rel="noopener" href="https://service.weibo.com/share/share.php?url=http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/&title=docker go"><i
                    class="fab fa-weibo " aria-hidden="true"></i></a></li>
    <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/&text=docker go"><i
                    class="fab fa-twitter " aria-hidden="true"></i></a></li>
    <li><a class="icon" href="mailto:?subject=docker go&body=Check out this article: http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/"><i
                    class="fas fa-envelope " aria-hidden="true"></i></a></li>
</ul>
    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Go"><span class="toc-number">1.</span> <span class="toc-text">Docker Go</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%90%8D%E8%AF%8D%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">一、名词概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">二、Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">(1)环境准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.2.</span> <span class="toc-text">(2) 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8docker"><span class="toc-number">1.2.3.</span> <span class="toc-text">(3)启动docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8D%B8%E8%BD%BDdocker"><span class="toc-number">1.2.4.</span> <span class="toc-text">(4) 卸载docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">1.2.5.</span> <span class="toc-text">(5) 阿里云镜像加速</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.</span> <span class="toc-text">三、 docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.1.</span> <span class="toc-text">(1)帮助命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.2.</span> <span class="toc-text">(2)镜像命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.3.</span> <span class="toc-text">(3)容器命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.4.</span> <span class="toc-text">(4)常用其他命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.4.</span> <span class="toc-text">四、docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.4.1.</span> <span class="toc-text">(1)镜像是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.2.</span> <span class="toc-text">(2)docker镜像加载原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%90%86%E8%A7%A3%E5%88%86%E5%B1%82"><span class="toc-number">1.4.3.</span> <span class="toc-text">(3)理解分层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-commit%E9%95%9C%E5%83%8F"><span class="toc-number">1.4.4.</span> <span class="toc-text">(4)commit镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.</span> <span class="toc-text">五、容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.1.</span> <span class="toc-text">(1)什么是容器数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.2.</span> <span class="toc-text">(2)使用数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9D%E5%A7%8Bdockerfile"><span class="toc-number">1.5.3.</span> <span class="toc-text">(3)初始dockerfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">1.5.4.</span> <span class="toc-text">(4)数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81DockerFile"><span class="toc-number">1.6.</span> <span class="toc-text">六、DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.1.</span> <span class="toc-text">(1) 基本介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-dockerfile%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.2.</span> <span class="toc-text">(2) dockerfile常用指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%80%9A%E8%BF%87dockerfile%E5%88%9B%E5%BB%BAtomcat%E9%95%9C%E5%83%8F"><span class="toc-number">1.6.3.</span> <span class="toc-text">(3) 通过dockerfile创建tomcat镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.6.4.</span> <span class="toc-text">(4) 发布自己的镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">1.7.</span> <span class="toc-text">七、Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%90%86%E8%A7%A3Docker0"><span class="toc-number">1.7.1.</span> <span class="toc-text">(1) 理解Docker0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E2%80%93link-%E4%B8%8D%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.2.</span> <span class="toc-text">(2) –link(不建议使用)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">1.7.3.</span> <span class="toc-text">(3) 自定义网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">1.7.4.</span> <span class="toc-text">(4) 网络连通</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81-%E9%83%A8%E7%BD%B2redis%E9%9B%86%E7%BE%A4"><span class="toc-number">1.8.</span> <span class="toc-text">八、 部署redis集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83-%E9%B8%A3%E8%B0%A2"><span class="toc-number">1.8.1.</span> <span class="toc-text">参考&amp;鸣谢</span></a></li></ol></li></ol></li></ol>
    </div>
  </span>
</div>

<div class="content index py4">
    
    <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        docker go
    </h1>

      <div class="meta">
        <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <span itemprop="name">
            
                  John Doe
                    
          </span>
        </span>
        
    <div class="postdate">
        
            <time datetime="2021-04-06T12:08:21.000Z"
                  itemprop="datePublished">2021-04-06</time>
            
                (Updated:
                <time datetime="2021-07-17T14:45:44.055Z"
                      itemprop="dateModified">2021-07-17</time>)
            
        
    </div>

          
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a> › <a class="category-link" href="/categories/%E5%90%8E%E7%AB%AF/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
    </div>

            
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/docker/" rel="tag">docker</a>, <a class="tag-link-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a>
    </div>

      </div>
  </header>
  
    <div class="content" itemprop="articleBody">
      <h2 id="Docker-Go"><a href="#Docker-Go" class="headerlink" title="Docker Go"></a>Docker Go</h2><p><a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></p>
<h3 id="一、名词概念"><a href="#一、名词概念" class="headerlink" title="一、名词概念"></a>一、名词概念</h3><blockquote>
<p>镜像（image）:好比一个模板，可以通过这个模板创建多个容器</p>
</blockquote>
<blockquote>
<p>容器（container）：Docker 利用容器技术，独立运行一个或者一组应用，容器通过镜像创建</p>
</blockquote>
<blockquote>
<p>仓库（repository）：存放镜像的地方，和git一样，分为共有和私有仓库</p>
</blockquote>
<p><escape><span id="more"></span></escape></p>
<hr>
<h3 id="二、Docker安装"><a href="#二、Docker安装" class="headerlink" title="二、Docker安装"></a>二、Docker安装</h3><h4 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="(1)环境准备"></a>(1)环境准备</h4><p>Linux  内核版本（3.10以上）：</p>
<blockquote>
<p>[root@iZuf6fxcajmbixlsw2ipm1Z ~]# uname -r<br>3.10.0-957.21.3.el7.x86_64</p>
</blockquote>
<p>Linux版本</p>
<blockquote>
<p>[root@iZuf6fxcajmbixlsw2ipm1Z ~]# cd &#x2F;<br>[root@iZuf6fxcajmbixlsw2ipm1Z &#x2F;]# cat etc&#x2F;os-release<br>NAME&#x3D;”CentOS Linux”<br>VERSION&#x3D;”7 (Core)”<br>ID&#x3D;”centos”<br>ID_LIKE&#x3D;”rhel fedora”<br>VERSION_ID&#x3D;”7”<br>PRETTY_NAME&#x3D;”CentOS Linux 7 (Core)”<br>ANSI_COLOR&#x3D;”0;31”<br>CPE_NAME&#x3D;”cpe:&#x2F;o:centos:centos:7”<br>HOME_URL&#x3D;”<a target="_blank" rel="noopener" href="https://www.centos.org/">https://www.centos.org/</a>“<br>BUG_REPORT_URL&#x3D;”<a target="_blank" rel="noopener" href="https://bugs.centos.org/">https://bugs.centos.org/</a>“</p>
<p>CENTOS_MANTISBT_PROJECT&#x3D;”CentOS-7”<br>CENTOS_MANTISBT_PROJECT_VERSION&#x3D;”7”<br>REDHAT_SUPPORT_PRODUCT&#x3D;”centos”<br>REDHAT_SUPPORT_PRODUCT_VERSION&#x3D;”7”</p>
</blockquote>
<h4 id="2-安装"><a href="#2-安装" class="headerlink" title="(2) 安装"></a>(2) 安装</h4><p><a target="_blank" rel="noopener" href="https://docs.docker.com/engine/install/centos/">https://docs.docker.com/engine/install/centos/</a></p>
<ul>
<li>卸载旧版本</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>需要的安装包</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>设置镜像仓库</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">国外镜像</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">阿里云镜像(推荐)</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>更新yum软件包索引</li>
</ul>
<blockquote>
<p>yum makecache fast</p>
</blockquote>
<ul>
<li>安装docker引擎</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># ce: 社区版  ee: 企业版</span></span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="3-启动docker"><a href="#3-启动docker" class="headerlink" title="(3)启动docker"></a>(3)启动docker</h4><ul>
<li>查看版本</li>
</ul>
<blockquote>
<p>docker version</p>
</blockquote>
<ul>
<li>启动docker</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>启动helloworld</li>
</ul>
<blockquote>
<p>docker run hello-world</p>
</blockquote>
<ul>
<li>查看下载的helloworld镜像</li>
</ul>
<blockquote>
<p>docker images</p>
</blockquote>
<h4 id="4-卸载docker"><a href="#4-卸载docker" class="headerlink" title="(4) 卸载docker"></a>(4) 卸载docker</h4><ul>
<li>卸载依赖</li>
</ul>
<blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum remove docker<span class="literal">-ce</span> docker<span class="literal">-ce-cli</span> containerd.io</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>删除资源</li>
</ul>
<blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> <span class="literal">-rf</span> /var/lib/docker</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="5-阿里云镜像加速"><a href="#5-阿里云镜像加速" class="headerlink" title="(5) 阿里云镜像加速"></a>(5) 阿里云镜像加速</h4><ul>
<li>登陆阿里云，进入容器镜像服务，找到镜像加速地址</li>
</ul>
<p><img src="https://i.loli.net/2021/05/27/3mf7FAOLG6d2Jyn.png" alt="image-20210527152541270"></p>
<ul>
<li>配置使用</li>
</ul>
<blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;sudo mkdir <span class="literal">-p</span> /etc/docker</span><br><span class="line"></span><br><span class="line">&gt;sudo <span class="built_in">tee</span> /etc/docker/daemon.json &lt;&lt;-<span class="string">&#x27;EOF&#x27;</span></span><br><span class="line">&gt;&#123;</span><br><span class="line"> <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://b6oassmo.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&gt;&#125;</span><br><span class="line"></span><br><span class="line">&gt;EOF</span><br><span class="line"></span><br><span class="line">&gt;sudo systemctl daemon<span class="literal">-reload</span></span><br><span class="line"></span><br><span class="line">&gt;sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h3 id="三、-docker常用命令"><a href="#三、-docker常用命令" class="headerlink" title="三、 docker常用命令"></a>三、 docker常用命令</h3><h4 id="1-帮助命令"><a href="#1-帮助命令" class="headerlink" title="(1)帮助命令"></a>(1)帮助命令</h4><blockquote>
<p>docker version	## 版本信息</p>
<p>docker info	## 显示docker信息，包括镜像和容器镜像</p>
<p>docker 命令 –help	##docker所有命令</p>
</blockquote>
<p>官方文档： <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/docker/">https://docs.docker.com/engine/reference/commandline/docker/</a></p>
<h4 id="2-镜像命令"><a href="#2-镜像命令" class="headerlink" title="(2)镜像命令"></a>(2)镜像命令</h4><ul>
<li>查看所有镜像</li>
</ul>
<blockquote>
<p>docker images</p>
</blockquote>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@iZuf6fxcajmbixlsw2ipm1Z /]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx         latest    d1a364dc548d   41 hours ago   133MB</span><br><span class="line">mysql         8.0       c0cdc95609f1   2 weeks ago    556MB</span><br><span class="line">hello-world   latest    d1165f221234   2 months ago   13.3kB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解释</span></span><br><span class="line">REPOSITORY	镜像仓库源</span><br><span class="line">TAG			镜像标签</span><br><span class="line">IMAGE ID	镜像ID</span><br><span class="line">CREATED		创建时间</span><br><span class="line">SIZE		大小</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可选项</span></span><br><span class="line">docker images --help</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>搜索镜像</li>
</ul>
<blockquote>
<p>docker search image</p>
</blockquote>
<ul>
<li>添加镜像</li>
</ul>
<blockquote>
<p>docker pull image [:tag]</p>
</blockquote>
<blockquote>
<p>tag 不写，默认为latest</p>
<p>#指定版本</p>
<p>docker pull mysql :5.7</p>
</blockquote>
<ul>
<li>删除镜像</li>
</ul>
<blockquote>
<p>docker rmi  -f  imageId&#x2F;repository    删除指定镜像</p>
<p>docker rmi -f  $(docker images -aq)   删除所有镜像</p>
</blockquote>
<h4 id="3-容器命令"><a href="#3-容器命令" class="headerlink" title="(3)容器命令"></a>(3)容器命令</h4><ul>
<li>新建容器</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run [参数] image</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">参数说明</span></span><br><span class="line">--name=&quot;name&quot;		#容器名称</span><br><span class="line">-d					#后台方式运行</span><br><span class="line">-it					#交互方式运行</span><br><span class="line">-p					#指定容器端口</span><br><span class="line">	-p ip:主机端口:容器端口</span><br><span class="line">	-p 主机端口:容器端口(常用)</span><br><span class="line">	-p 容器端口</span><br><span class="line">	[default] 随机指定端口</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>从容器中退出至主机</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit	  #退出(交互方式启动的容器会被停止)</span><br><span class="line">ctrl+p+q  #容器不停止并退出</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>查看所有运行的容器</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps	#列出当前正在运行的容器</span><br><span class="line">	-a		#列出当前正在运行的容器和历史运行过的容器</span><br><span class="line">	-n=?	#列出最近创建的容器</span><br><span class="line">	-q		#只显示容器的编号</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>删除容器</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id					#删除指定容器，不能删除正在运行的容器</span><br><span class="line">docker rm -f 容器id				#强制删除容器</span><br><span class="line">docker rm -f $(docker ps -aq) 	 #删除所有容器</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>启动和停止容器</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id	</span><br><span class="line">docker restart 容器id	</span><br><span class="line">docker stop 容器id	#停止当前正在运行的容器</span><br><span class="line">docker kill 容器id	#强制停止当前容器</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="4-常用其他命令"><a href="#4-常用其他命令" class="headerlink" title="(4)常用其他命令"></a>(4)常用其他命令</h4><ul>
<li>后台启动容器</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker run -d 镜像名</span></span><br><span class="line"></span><br><span class="line">[root@silen /]# docker run -d centos</span><br><span class="line">ef01dda2ef4ad15b57b4c698e1bfdbc3f172f19417cb1b1c86695d809477b09e</span><br><span class="line">[root@silen /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">问题：docker ps 查看容器，发现容器停止了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">原因：docker容器后台运行时，如果容器内没有程序运行，就会自动停止，比如</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">	   nginx后台启动后，如果没有提供服务，就会立刻停止</span></span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>查看日志</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker logs</span><br><span class="line">	-tf 		#显示日志</span><br><span class="line">	--tail xx	#显示xx条日志</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>查看容器中的进程信息</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker top 容器id</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>查看镜像元数据</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器id</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>进入当前正在运行的容器</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker <span class="built_in">exec</span> -it 容器<span class="built_in">id</span> bashShell</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入容器后 开启一个新的终端，可以在里面进行操作（常用）</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker attach 容器<span class="built_in">id</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入容器正在执行的终端，不会启动新的进程</span></span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>从容器中拷贝文件到主机上</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">docker 容器<span class="built_in">id</span>:/容器内文件路径 主机文件夹路径</span></span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>查看docker占用cpu及内存情况</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>添加docker容器内存限制</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; iamge</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li><p>可视化</p>
<ul>
<li>portainer</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \</span><br><span class="line">	--restart=always \</span><br><span class="line">	-v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">	--privileged=true \</span><br><span class="line">	portainer/portainer</span><br><span class="line"><span class="meta prompt_">	</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 容器启动后 浏览器访问 ip:8088即可</span></span></span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>rancher</li>
</ul>
</li>
</ul>
<hr>
<h3 id="四、docker镜像"><a href="#四、docker镜像" class="headerlink" title="四、docker镜像"></a>四、docker镜像</h3><h4 id="1-镜像是什么"><a href="#1-镜像是什么" class="headerlink" title="(1)镜像是什么"></a>(1)镜像是什么</h4><p>​	镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含某个软件所需的所有的内容，包括代码、运行时所需的库、环境变量、配置文件等全部内容。所有的docker容器，直接打包为docker镜像后就可以直接运行。</p>
<h4 id="2-docker镜像加载原理"><a href="#2-docker镜像加载原理" class="headerlink" title="(2)docker镜像加载原理"></a>(2)docker镜像加载原理</h4><ul>
<li>UnionFS(联合文件系统）</li>
</ul>
<p>​     联合文件系统是一种分层轻量高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层地叠加，同时可以将不同的目录挂载到同一个虚拟文件系统下。联合文件系统是docker镜像的基础，镜像可以通过分层来进行继承，基于基础镜像，可以制作各种具体的应用镜像。</p>
<p>  特点：一次同时加载多个文件系统，但从外面看来只是一个文件系统，通过联合加载把各层文件系统叠加起来，这样最终的文件系统就会包含所有的底层文件和目录。</p>
<ul>
<li>镜像加载原理</li>
</ul>
<p>​    docker的镜像实际上由一层层文件系统组成，这种层级的文件系统被称为unionFS</p>
<blockquote>
<p>bootfs</p>
</blockquote>
<p>​    主要包含bootloader和kernel,bootloader主要负责引导加载kernel,linux刚启动是会加载bootfs文件系统，在docker最底层是bootfs，这和linux&#x2F;unix是一样的，包含boot加载器和内核，当boot加载完成后整个内核就在内存之中了，此时内存使用权由bootfs交给内核，系统也会卸载bootfs.</p>
<blockquote>
<p>rootfs</p>
</blockquote>
<p>​    在bootfs之上就是典型linux系统中的&#x2F;dev,&#x2F;proc,&#x2F;bin,&#x2F;etc等标准文件和目录，rootfs就是不同操作系统发行版，如ubuntu,centos等。</p>
<h4 id="3-理解分层"><a href="#3-理解分层" class="headerlink" title="(3)理解分层"></a>(3)理解分层</h4><p>输入<code>docker pull redis</code>,下载redis镜像：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@silen /]# docker pull redis</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/redis</span><br><span class="line">69692152171a: Already exists</span><br><span class="line">a4a46f2fd7e0: Pull complete</span><br><span class="line">bcdf6fddc3bd: Pull complete</span><br><span class="line">b7e9b50900cc: Pull complete</span><br><span class="line">5f3030c50d85: Pull complete</span><br><span class="line">63dae8e0776c: Pull complete</span><br><span class="line">Digest: sha256:365eddf64356169aa0cbfbeaf928eb80762de3cc364402e7653532bcec912973</span><br><span class="line">Status: Downloaded newer image for redis:latest</span><br><span class="line">docker.io/library/redis:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​	观察日志，可以发现docker获取镜像时是一层层的在下载文件，这样的好处在于，镜像的每一层是可以共享的，当多个镜像由同一个base镜像构建而来时，那么宿主机上只需保留一份base镜像，同时内存中也只需要加载一份base镜像，就可以为所有的容器服务了。</p>
<p>​	输入<code>docker image inspect</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@silen /]# docker image inspect redis:latest</span><br><span class="line">[</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:02c055ef67f5904019f43a41ea5f099996d8e7633749b6e606c400526b2c4b33&quot;,</span><br><span class="line">                &quot;sha256:ec5652c3523d96657d66169c0eb71b572ff065711c705a15ec02f60a21c212c3&quot;,</span><br><span class="line">                &quot;sha256:76d3e24d63f60e6a73af70be15959eb4021dd7a5a09da6925037d3b4a1673fca&quot;,</span><br><span class="line">                &quot;sha256:f281464c05be6822b95403339e2b7744fd1664e88ee9d118c7e89436ab094d58&quot;,</span><br><span class="line">                &quot;sha256:7fde79e38c038ef46904196710861e2c556363d723b8f8bf9b00369944d36aec&quot;,</span><br><span class="line">                &quot;sha256:6d4185a1708b677241d83683283c76703e788e41a2341b7c1bf4dbf12aebab45&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">	...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>​	可以查看联合文件系统的rootFS中的镜像分层情况，docker的镜像都是只读的，当容器启动时，一个新的可写cent会被加载到镜像层的顶部，这一层就是容器层，当再次生成新镜像时，容器层的文件会覆盖镜像层的文件，实现镜像的更新。</p>
<h4 id="4-commit镜像"><a href="#4-commit镜像" class="headerlink" title="(4)commit镜像"></a>(4)commit镜像</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker commit	提交容器成为一个新的副本</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令和git类似</span></span><br><span class="line">docker commit -m=&quot;备注&quot; -a=&quot;author&quot; 容器id 目标镜像名[:TAG]</span><br></pre></td></tr></table></figure>



<h3 id="五、容器数据卷"><a href="#五、容器数据卷" class="headerlink" title="五、容器数据卷"></a>五、容器数据卷</h3><h4 id="1-什么是容器数据卷"><a href="#1-什么是容器数据卷" class="headerlink" title="(1)什么是容器数据卷"></a>(1)什么是容器数据卷</h4><p>​	如果数据都在容器中，那么删除容器时，数据就会丢失，容器数据卷就是将数据持久化，将docker容器中产生的数据，同步到本地，这就是数据卷技术，通过目录的挂载，将容器内的目录，挂载到linux上面。</p>
<h4 id="2-使用数据卷"><a href="#2-使用数据卷" class="headerlink" title="(2)使用数据卷"></a>(2)使用数据卷</h4><ul>
<li>直接使用命令挂载</li>
</ul>
<blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器内目录 镜像</span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##测试</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##linux主机：</span></span></span><br><span class="line">[root@silen ~]# cd /home</span><br><span class="line">[root@silen home]# ls</span><br><span class="line">admin  mysql</span><br><span class="line">创建并运行容器</span><br><span class="line">[root@silen home]# docker run -it -v /home/test:/home centos /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#容器内</span></span></span><br><span class="line">[root@6ff47adc736d /]# cd home</span><br><span class="line">[root@6ff47adc736d home]# ls</span><br><span class="line">[root@6ff47adc736d home]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">##主机内</span></span></span><br><span class="line">[root@silen home]# docker inspect 6ff47adc736d</span><br><span class="line">[</span><br><span class="line">	...</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/test&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/home&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">	...</span><br><span class="line">]</span><br><span class="line">[root@silen home]# cd test</span><br><span class="line">[root@silen test]# ls</span><br><span class="line">[root@silen test]# touch test.java</span><br><span class="line">[root@silen test]# ls</span><br><span class="line">test.java</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## 进入容器</span></span></span><br><span class="line">[root@silen test]# docker start 6ff47adc736d</span><br><span class="line">6ff47adc736d</span><br><span class="line">[root@silen test]# docker attach 6ff47adc736d</span><br><span class="line">[root@6ff47adc736d /]# cd home</span><br><span class="line">[root@6ff47adc736d home]# ls</span><br><span class="line">test.java	##主机中创建的文件在容器中也可看到，反之亦然</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 停止容器，返回主机，编辑文件，输入helloworld</span></span></span><br><span class="line">[root@6ff47adc736d home]# exit</span><br><span class="line">[root@silen test]# vim test.java</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">###启动并进入容器，查看文件</span></span></span><br><span class="line">[root@silen test]# docker start 6ff47adc736d</span><br><span class="line">[root@silen test]# docker attach 6ff47adc736d</span><br><span class="line">[root@6ff47adc736d /]# cd home</span><br><span class="line">[root@6ff47adc736d home]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@6ff47adc736d home]# cat test.java</span><br><span class="line">hello world</span><br><span class="line">[root@6ff47adc736d home]#</span><br></pre></td></tr></table></figure>

<p><strong>好处</strong>：完成目录挂载后，对容器内文件的修改只需要在主机本地即可，不需要进入容器</p>
<ul>
<li>mysql数据持久化</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@silen test]# docker run -d -p 3310:3306 -v /home/mysql01/conf:/etc/mysql/conf.d \</span><br><span class="line"> -v /home/mysql01/data:/var/lib/mysql \</span><br><span class="line"> -e MYSQL_ROOT_PASSWORD=123456 \</span><br><span class="line"> --name mysql01 mysql:5.7</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#</span></span></span><br><span class="line"> docker run </span><br><span class="line"> 	-d	后台运行</span><br><span class="line"> 	-v	数据卷挂载</span><br><span class="line"> 	-p	端口映射</span><br><span class="line"> 	-e	环境配置</span><br><span class="line"> 	--name 容器名称</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 本地使用navicat连接到服务器3310端口，映射至容器端口3306，在navicat新建数据库test01</span></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 进入linux数据卷挂载文件夹，可以看到新建的数据库文件，代表数据持久化成功</span></span></span><br><span class="line">[root@silen home]# cd mysql01</span><br><span class="line">[root@silen mysql01]# ls</span><br><span class="line">conf  data</span><br><span class="line">[root@silen mysql01]# cd data</span><br><span class="line">[root@silen data]# ls</span><br><span class="line">auto.cnf         client-key.pem  ib_logfile1         private_key.pem  sys</span><br><span class="line">ca-key.pem       ib_buffer_pool  ibtmp1              public_key.pem   test01</span><br><span class="line">ca.pem           ibdata1         mysql               server-cert.pem</span><br><span class="line">client-cert.pem  ib_logfile0     performance_schema  server-key.pem</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 删除容器，查看数据卷，可以发现数据仍然存在</span></span></span><br><span class="line">[root@silen ~]# docker stop 94f9ae46d646</span><br><span class="line">94f9ae46d646</span><br><span class="line">[root@silen ~]# docker rm 94f9ae46d646</span><br><span class="line">94f9ae46d646</span><br><span class="line">[root@silen ~]# cd home</span><br><span class="line">-bash: cd: home: No such file or directory</span><br><span class="line">[root@silen ~]# cd /home</span><br><span class="line">[root@silen home]# ls</span><br><span class="line">admin  mysql  mysql01  test</span><br><span class="line">[root@silen home]# cd mysql01</span><br><span class="line">[root@silen mysql01]# ls</span><br><span class="line">conf  data</span><br><span class="line">[root@silen mysql01]# cd data</span><br><span class="line">[root@silen data]# ls</span><br><span class="line">auto.cnf         client-key.pem  ib_logfile1         public_key.pem   test01</span><br><span class="line">ca-key.pem       ib_buffer_pool  mysql               server-cert.pem</span><br><span class="line">ca.pem           ibdata1         performance_schema  server-key.pem</span><br><span class="line">client-cert.pem  ib_logfile0     private_key.pem     sys</span><br><span class="line">[root@silen data]#</span><br></pre></td></tr></table></figure>

<ul>
<li><p>具名、匿名挂载</p>
<ul>
<li>匿名挂载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看本地volume</span></span><br><span class="line">[root@silen data]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     2f14b4c1e2ba480236e9d08e9ddaf761241d70b9ecc198d1d980baff3ec5abd4</span><br><span class="line">local     4eac5f4b5b7c60b3fd219eb56c221b20237ed8baf5e0e24a0cdfc89ab2a8f0a4</span><br><span class="line">local     11bf57d882b07841c6fbb961f29a9393ff11523229f25ca52f8b5485c24e8cfc</span><br><span class="line">local     50ca134cdbe44b25f6e8281505ff291af849230041a54db163bdcebd07255296</span><br><span class="line">local     424e3dead437fe39e8ca2d3967a5da1fed8c568a905388e0b2d19689992f5c0a</span><br><span class="line">local     08143fa30a9fa3ac06635b67c10ef204d323feefea07769f82f7e8acc363e901</span><br><span class="line">local     44791efafdf0d1ec228986451e1a0e427b872a4b105931933c28fe34be842172</span><br><span class="line">local     68920dc566dc4f04e63d1c73eabd5bad3593093ce089815665003c2836cd7cf0</span><br><span class="line">local     672061e9592b1d0e54d8ef2fe573e1aae4a0a070376a8421f70bb8551cd4db4d</span><br><span class="line">local     c39891dea4db71f20de3aa60de6f6e7e93abe2411d79adf7a6425baedcfd72e6</span><br><span class="line">local     d276fcbdfe95e9b614a346d19dc4d4c8d4cfc51f46768f1b98a0c1801dfd33eb</span><br><span class="line">local     d4034a1c6d9d714f91c4cd6f06687f554f07742f6a098ac6380e5902a1d14c36</span><br><span class="line">local     d81159816e064d35bde49aedf850a9f0e2ea06f3f5ad34f69edbc92d558f94fd</span><br><span class="line">local     f0f847e369a775b9a7f6bc945546cec6346d4cfb8d06ca1d3b64981f4a44e0bd</span><br><span class="line">local     f7957a4a57793eedb77c948e9774ab23e5ec40235720006fe14311d99c1590fc</span><br><span class="line"></span><br><span class="line">这些数据卷就是启动容器时 -v只写了容器内路径，并没有指定卷名</span><br></pre></td></tr></table></figure>

<ul>
<li>具名挂载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">-v 卷名：容器内路径</span><br><span class="line">docker run -d -P --name nginx02 -v nginx-volume:/etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">#查看本地volume,可以看到卷名</span></span></span><br><span class="line">[root@silen data]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     2f14b4c1e2ba480236e9d08e9ddaf761241d70b9ecc198d1d980baff3ec5abd4</span><br><span class="line">local     4eac5f4b5b7c60b3fd219eb56c221b20237ed8baf5e0e24a0cdfc89ab2a8f0a4</span><br><span class="line">local     11bf57d882b07841c6fbb961f29a9393ff11523229f25ca52f8b5485c24e8cfc</span><br><span class="line">local     50ca134cdbe44b25f6e8281505ff291af849230041a54db163bdcebd07255296</span><br><span class="line">local     424e3dead437fe39e8ca2d3967a5da1fed8c568a905388e0b2d19689992f5c0a</span><br><span class="line">local     08143fa30a9fa3ac06635b67c10ef204d323feefea07769f82f7e8acc363e901</span><br><span class="line">local     44791efafdf0d1ec228986451e1a0e427b872a4b105931933c28fe34be842172</span><br><span class="line">local     68920dc566dc4f04e63d1c73eabd5bad3593093ce089815665003c2836cd7cf0</span><br><span class="line">local     672061e9592b1d0e54d8ef2fe573e1aae4a0a070376a8421f70bb8551cd4db4d</span><br><span class="line">local     c39891dea4db71f20de3aa60de6f6e7e93abe2411d79adf7a6425baedcfd72e6</span><br><span class="line">local     d276fcbdfe95e9b614a346d19dc4d4c8d4cfc51f46768f1b98a0c1801dfd33eb</span><br><span class="line">local     d4034a1c6d9d714f91c4cd6f06687f554f07742f6a098ac6380e5902a1d14c36</span><br><span class="line">local     d81159816e064d35bde49aedf850a9f0e2ea06f3f5ad34f69edbc92d558f94fd</span><br><span class="line">local     f0f847e369a775b9a7f6bc945546cec6346d4cfb8d06ca1d3b64981f4a44e0bd</span><br><span class="line">local     f7957a4a57793eedb77c948e9774ab23e5ec40235720006fe14311d99c1590fc</span><br><span class="line">local     nginx-volume</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看容器信息</span></span></span><br><span class="line">[root@silen data]# docker inspect c339503ea85d</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;nginx-volume&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/nginx-volume/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/etc/nginx&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;z&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>注</strong>：所有docker容器内的数据卷，在没有指定目录的情况下，都是挂载在**&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volume&#x2F;xxx&#x2F;_data**中。</p>
<ul>
<li>挂载总结</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -v</span><br><span class="line">	容器内路径				#匿名挂载</span><br><span class="line">	卷名：容器内路径		  #具名挂载</span><br><span class="line">	/宿主机路径：容器内路径	#指定路径挂载</span><br><span class="line">	挂载方式：ro				#容器对卷数据只读</span><br><span class="line">	挂载方式：rw				#容器对卷数据可读可写（默认）</span><br><span class="line">	</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-初始dockerfile"><a href="#3-初始dockerfile" class="headerlink" title="(3)初始dockerfile"></a>(3)初始dockerfile</h4><p>​	dockerfile 就是用来构建镜像的构建文件，是一个命令脚本,通过这个脚本可以生成一个镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建dockerfile,文件中指令大写</span></span><br><span class="line">[root@silen docker-test-volume]# pwd</span><br><span class="line">/home/docker-test-volume</span><br><span class="line">[root@silen docker-test-volume]# vim dockerfile1</span><br><span class="line">[root@silen docker-test-volume]# cat dockerfile1</span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;---end---&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line">[root@silen docker-test-volume]#</span><br><span class="line"></span><br><span class="line">[root@silen docker-test-volume]# docker build -f dockerfile1 -t silen/centos:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">300e315adb2f</span></span><br><span class="line">Step 2/4 : VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 96e729a02b98</span></span><br><span class="line">Removing intermediate container 96e729a02b98</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">31fa58d562c3</span></span><br><span class="line">Step 3/4 : CMD echo &quot;---end---&quot;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> c95cf66683d7</span></span><br><span class="line">Removing intermediate container c95cf66683d7</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">95aca73cb1ca</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 5e234aba1c88</span></span><br><span class="line">Removing intermediate container 5e234aba1c88</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">6c391965830e</span></span><br><span class="line">Successfully built 6c391965830e</span><br><span class="line">Successfully tagged silen/centos:1.0</span><br><span class="line">[root@silen docker-test-volume]# docker images</span><br><span class="line">REPOSITORY     TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">silen/centos   1.0       6c391965830e   31 seconds ago   209MB</span><br><span class="line">tomcat02       1.0       c0211205168e   37 hours ago     672MB</span><br><span class="line">nginx          latest    d1a364dc548d   5 days ago       133MB</span><br><span class="line">tomcat         latest    c43a65faae57   2 weeks ago      667MB</span><br><span class="line">redis          latest    bc8d70f9ef6c   2 weeks ago      105MB</span><br><span class="line">mysql          5.7       2c9028880e58   2 weeks ago      447MB</span><br><span class="line">mysql          8.0       c0cdc95609f1   2 weeks ago      556MB</span><br><span class="line">centos         latest    300e315adb2f   5 months ago     209MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建并进入容器，可以发现dockerfile中挂载的两个目录</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker run -it 6c391965830e /bin/bash</span><br><span class="line">[root@1a637451e4ea /]# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  360 May 31 02:24 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 31 02:24 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 100 root root    0 May 31 02:24 proc</span><br><span class="line">dr-xr-x---   2 root root 4096 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x  11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 May 31 02:24 sys</span><br><span class="line">drwxrwxrwt   7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x  12 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x  20 root root 4096 Dec  4 17:37 var</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 31 02:24 volume01</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 31 02:24 volume02</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 这两个目录在主机上一定有目录与其对应，并且属于匿名挂载</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看容器详情，可以查看挂载路径，确实属于匿名挂载</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker inspect 1a637451e4ea</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;a54ca1682de7899cc961c8472353a3c2689cae4435a7b5381bf6b59f63c50e93&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/a54ca1682de7899cc961c8472353a3c2689cae4435a7b5381bf6b59f63c50e93/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume01&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;b2efb2cf143340b264c5c9dc00187f5de5d28f40990c5c31486dd29b8c1db112&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/b2efb2cf143340b264c5c9dc00187f5de5d28f40990c5c31486dd29b8c1db112/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br></pre></td></tr></table></figure>

<h4 id="4-数据卷容器"><a href="#4-数据卷容器" class="headerlink" title="(4)数据卷容器"></a>(4)数据卷容器</h4><p>​	实现容器间数据同步</p>
<p><img src="https://i.loli.net/2021/05/31/Ig2lwLEHQxYAdi1.png" alt="image-20210531103356094"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">docker run --volume-from dockername</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 基于之前通过dockerfile创建的镜像，创建容器docker01</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker run -it --name docker01  6c391965830e</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建docker02，与docker01同步挂载</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 可以看到docker02中同样有数据卷 volume01, volume02</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker run -it --name docker02 --volumes-from docker01  6c391965830e</span><br><span class="line">[root@286d985aba6d /]# ls</span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 进入docker01，进入数据卷，创建文件test.java</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker attach c5afba6a2b04</span><br><span class="line">[root@c5afba6a2b04 /]# ls</span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line">[root@c5afba6a2b04 /]# cd volume01</span><br><span class="line">[root@c5afba6a2b04 volume01]# touch test.java</span><br><span class="line">[root@c5afba6a2b04 volume01]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@c5afba6a2b04 volume01]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 进入docker02，进入数据卷，可以发现数据实现了同步</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker attach 286d985aba6d</span><br><span class="line">[root@286d985aba6d /]# ls</span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line">[root@286d985aba6d /]# cd volume01</span><br><span class="line">[root@286d985aba6d volume01]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@286d985aba6d volume01]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建docker03，与docker02同步挂载</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 进入docker03数据卷，创建文件test02.java</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker run -it --name docker03 --volumes-from docker02 6c391965830e</span><br><span class="line">[root@daebdf488714 /]# ls</span><br><span class="line">bin  etc   lib    lost+found  mnt  proc  run   srv  tmp  var       volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line">[root@daebdf488714 /]# cd volume01</span><br><span class="line">[root@daebdf488714 volume01]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@daebdf488714 volume01]# touch test02.java</span><br><span class="line">[root@daebdf488714 volume01]# ls</span><br><span class="line">test.java  test02.java</span><br><span class="line">[root@daebdf488714 volume01]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 进入docker01,进入数据卷，可以发现docker01与docker03也会数据同步</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker attach c5afba6a2b04</span><br><span class="line">[root@c5afba6a2b04 volume01]# ls</span><br><span class="line">test.java  test02.java</span><br><span class="line">[root@c5afba6a2b04 volume01]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 停止并删除docker01，进入docker02,查看数据卷，数据还在</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker stop c5afba6a2b04</span><br><span class="line">c5afba6a2b04</span><br><span class="line">[root@silen docker-test-volume]# docker rm c5afba6a2b04</span><br><span class="line">c5afba6a2b04</span><br><span class="line">[root@silen docker-test-volume]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                                     NAMES</span><br><span class="line">daebdf488714   6c391965830e   &quot;/bin/sh -c /bin/bash&quot;   4 minutes ago    Up 4 minutes                                              docker03</span><br><span class="line">286d985aba6d   6c391965830e   &quot;/bin/sh -c /bin/bash&quot;   17 minutes ago   Up 17 minutes                                             docker02</span><br><span class="line">c339503ea85d   nginx          &quot;/docker-entrypoint.…&quot;   17 hours ago     Up 17 hours     0.0.0.0:49154-&gt;80/tcp, :::49154-&gt;80/tcp   nginx02</span><br><span class="line">3019e4d5299b   nginx          &quot;/docker-entrypoint.…&quot;   17 hours ago     Up 17 hours     0.0.0.0:49153-&gt;80/tcp, :::49153-&gt;80/tcp   nginx01</span><br><span class="line">[root@silen docker-test-volume]# docker attach 286d985aba6d</span><br><span class="line">[root@286d985aba6d volume01]# ls</span><br><span class="line">test.java  test02.java</span><br><span class="line">[root@286d985aba6d volume01]#</span><br></pre></td></tr></table></figure>

<p><strong>注</strong>：多个容器间数据卷同步挂载时，删除某一个容器，不影响其他容器的数据卷的正常挂载</p>
<hr>
<h3 id="六、DockerFile"><a href="#六、DockerFile" class="headerlink" title="六、DockerFile"></a>六、DockerFile</h3><h4 id="1-基本介绍"><a href="#1-基本介绍" class="headerlink" title="(1) 基本介绍"></a>(1) 基本介绍</h4><p>  dockfile是用来构建docker镜像的文件，构建步骤:</p>
<blockquote>
<p>1.编写dockerfile文件</p>
</blockquote>
<blockquote>
<p>2.docker build构建成一个镜像</p>
</blockquote>
<blockquote>
<p>3.docker run运行镜像</p>
</blockquote>
<blockquote>
<p>4.docker push发布镜像（dockerhub、阿里云镜像仓库）</p>
</blockquote>
<h4 id="2-dockerfile常用指令"><a href="#2-dockerfile常用指令" class="headerlink" title="(2) dockerfile常用指令"></a>(2) dockerfile常用指令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM		# 基础镜像，一切从这里构建</span><br><span class="line">MAINTAINER	# 作者（姓名&lt;邮箱&gt;）</span><br><span class="line">RUN			# 构建镜像的时候需要的命令</span><br><span class="line">ADD			# 添加的内容</span><br><span class="line">WORKDIR		# 镜像的工作目录</span><br><span class="line">VOLUME		# 挂载的目录</span><br><span class="line">EXPOSE		# 端口配置</span><br><span class="line">CMD			# 指定容器启动时要运行的命令,只有最后一个选项生效，可被替代</span><br><span class="line">ENTRYPOINT  # 指定容器启动时要运行的命令，可追加选项</span><br><span class="line">COPY		# 类似ADD，将文件拷贝至镜像中</span><br><span class="line">ENV			# 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>

<ul>
<li>CMD和ENTYRYPOINT的区别</li>
</ul>
<p><strong>CMD</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建dockerfile</span></span></span><br><span class="line">[root@silen docker-test-volume]# ls</span><br><span class="line">dockerfile1  docker-file-cmd</span><br><span class="line">[root@silen docker-test-volume]# cat docker-file-cmd</span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建镜像</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker build -f docker-file-cmd -t cmdtest .</span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">300e315adb2f</span></span><br><span class="line">Step 2/2 : CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 8bfe98f06707</span></span><br><span class="line">Removing intermediate container 8bfe98f06707</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">b5b77123ad0a</span></span><br><span class="line">Successfully built b5b77123ad0a</span><br><span class="line">Successfully tagged cmdtest:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建并运行容器，发现ls -a生效</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker run  b5b77123ad0a</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 追加命令选项 -l    ls -al</span></span></span><br><span class="line">[root@silen docker-test-volume]#  docker run  b5b77123ad0a -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:367: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line">[root@silen docker-test-volume]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ENTRYPOINT</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建dockerfile</span></span></span><br><span class="line">[root@silen docker-test-volume]# ls</span><br><span class="line">dockerfile1  docker-file-cmd</span><br><span class="line">[root@silen docker-test-volume]# vim docker-file-entrypoint</span><br><span class="line">[root@silen docker-test-volume]# cat docker-file-entrypoint</span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line">[root@silen docker-test-volume]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建镜像</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker build -f docker-file-entrypoint -t entrytest .</span><br><span class="line">Sending build context to Docker daemon  4.096kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">300e315adb2f</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> dad50470d106</span></span><br><span class="line">Removing intermediate container dad50470d106</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">eabf373b8aa1</span></span><br><span class="line">Successfully built eabf373b8aa1</span><br><span class="line">Successfully tagged entrytest:latest</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建并运行容器</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker run eabf373b8aa1</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 为命令追加选项-l 	ls -al</span></span></span><br><span class="line">[root@silen docker-test-volume]# docker run eabf373b8aa1 -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 31 05:33 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 31 05:33 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 May 31 05:33 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 May 31 05:33 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 31 05:33 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x 104 root root    0 May 31 05:33 proc</span><br><span class="line">dr-xr-x---   2 root root 4096 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x  11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 May 31 02:24 sys</span><br><span class="line">drwxrwxrwt   7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x  12 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x  20 root root 4096 Dec  4 17:37 var</span><br></pre></td></tr></table></figure>

<h4 id="3-通过dockerfile创建tomcat镜像"><a href="#3-通过dockerfile创建tomcat镜像" class="headerlink" title="(3) 通过dockerfile创建tomcat镜像"></a>(3) 通过dockerfile创建tomcat镜像</h4><ul>
<li><p>准备镜像文件	tomcat压缩包，jdk压缩包</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@silen tomcat]# ls</span><br><span class="line">apache-tomcat-7.0.55.tar.gz  jdk-8u51-linux-x64.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>编写dockerfile文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER silen&lt;silen.luan@xxx.com&gt;</span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line">ADD jdk-8u51-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-7.0.55.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_51</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-7.0.55</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-7.0.55</span><br><span class="line">ENV PATH $PATH:JAVA_HOME/bin:$CATALINA_HOME/lib:$ATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-7.0.55/bin/startup.sh &amp;&amp; tail -F  /usr/local/apache-tomcat-7.0.55/bin/logs/catalina.out</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>注</strong>：dockerfile官方命名<code>Dockerfile</code>, build时会自动在当前目录内寻找Docklefile文件，不需要加参数-f</p>
</li>
<li><p>构建镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t diytomcat .</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建并启动容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9090:8080 \</span><br><span class="line">	--name silentomcat \</span><br><span class="line">	-v /home/silen/build/tomcat/test:/usr/local/pache-tomcat-7.0.55/webapps/test \</span><br><span class="line">	-v /home/silen/build/tomcat/tomcatlogs:/usr/local/pache-tomcat-7.0.55/logs \</span><br><span class="line">	diytomcat</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问测试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl localhost:9090</span><br></pre></td></tr></table></figure>
</li>
<li><p>发布项目（实现数据卷挂载，在主机上发布即可）</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 本地进入挂载文件夹</span></span></span><br><span class="line">[root@silen tomcat]# cd test</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建index.jsp, WEB-INF/web.xml</span></span></span><br><span class="line">[root@silen tomcat]# touch index.jsp</span><br><span class="line">[root@silen tomcat]# mkdir WEB-INF</span><br><span class="line">[root@silen tomcat]# cd WEB-INF</span><br><span class="line">[root@silen tomcat]# touch web.xml</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 编写index.jsp</span></span></span><br><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;silen&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">Hello World!&lt;br/&gt;</span><br><span class="line">&lt;%</span><br><span class="line">System.out.println(&quot;--test tomcat--&quot;);</span><br><span class="line"><span class="meta prompt_">%</span><span class="language-bash">&gt;</span></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 编写web.xml</span></span></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee</span><br><span class="line">        http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span><br><span class="line">    version=&quot;2.5&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="4-发布自己的镜像"><a href="#4-发布自己的镜像" class="headerlink" title="(4) 发布自己的镜像"></a>(4) 发布自己的镜像</h4><ul>
<li>dockerhub</li>
</ul>
<blockquote>
<ol>
<li>前往<a target="_blank" rel="noopener" href="https://hub.docker.com/%EF%BC%8C%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7">https://hub.docker.com/，注册账号</a></li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>在服务器上提供自己的镜像</li>
</ol>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 登陆</span></span></span><br><span class="line">[root@silen tomcat]# docker login -u codesilence</span><br><span class="line">Password:</span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure>

<ul>
<li>阿里云镜像服务器</li>
</ul>
<blockquote>
<ol>
<li>登陆阿里云</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>找到容器镜像服务</li>
</ol>
</blockquote>
<blockquote>
<ol start="3">
<li>创建命名空间</li>
</ol>
</blockquote>
<p><img src="https://i.loli.net/2021/06/01/IdXFefspTnHb4hl.png" alt="image-20210601134217731"></p>
<blockquote>
<ol start="4">
<li>创建容器</li>
</ol>
</blockquote>
<p><img src="https://i.loli.net/2021/06/01/Q6tBF4lpUvMzJSg.png" alt="image-20210601134334864"></p>
<blockquote>
<ol start="5">
<li>点击管理查看官方教程</li>
</ol>
</blockquote>
<p><img src="https://i.loli.net/2021/06/01/3BthyrEowiLvKQc.png" alt="image-20210601134502658"></p>
<h3 id="七、Docker网络"><a href="#七、Docker网络" class="headerlink" title="七、Docker网络"></a>七、Docker网络</h3><h4 id="1-理解Docker0"><a href="#1-理解Docker0" class="headerlink" title="(1) 理解Docker0"></a>(1) 理解Docker0</h4><ul>
<li>测试</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 测试</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">事先清空所有镜像和容器</span></span><br><span class="line"></span><br><span class="line">[root@silen tomcat]# ip addr</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># lo: 本机回环地址</span></span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># eth0: 阿里云内网地址</span></span></span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:25:2d:9e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.29.20/18 brd 172.17.63.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315028366sec preferred_lft 315028366sec</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># docker0: docker0地址</span></span></span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    link/ether 02:42:d0:a4:c4:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># docker有三个网络，如何处理容器网络访问的？</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动容器，查看容器内部网络地址</span></span></span><br><span class="line">[root@silen tomcat]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line">[root@silen tomcat]# docker exec -it a7bcafef5fc7 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">94: eth0@if95: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># linux主机ping docker内部网络</span></span></span><br><span class="line">[root@silen tomcat]# ping  172.18.0.2</span><br><span class="line">PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.126 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.098 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=3 ttl=64 time=0.078 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=4 ttl=64 time=0.075 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=5 ttl=64 time=0.075 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=6 ttl=64 time=0.098 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 能ping通的原因</span></span></span><br><span class="line">linux主机 docker0地址：172.18.0.1</span><br><span class="line">docker容器ip: 172.18.0.2</span><br><span class="line">两者在同一网段下 所以可以ping通</span><br></pre></td></tr></table></figure>

<ul>
<li><p>原理</p>
<ul>
<li><p>我们每启动一个docker容器，docker就会给docker容器分配一个ip,只要安装了docker服务，就会有一个docker0网卡（桥接模式），使用的是evth-pair技术</p>
</li>
<li><p>再次测试</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动容器前,查看主机网卡ip</span></span></span><br><span class="line">[root@silen tomcat]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:25:2d:9e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.29.20/18 brd 172.17.63.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314959915sec preferred_lft 314959915sec</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default</span><br><span class="line">    link/ether 02:42:d0:a4:c4:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动容器</span></span></span><br><span class="line">[root@silen tomcat]# docker start a7bcafef5fc7</span><br><span class="line">a7bcafef5fc7</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 启动容器后,查看主机网卡ip</span></span></span><br><span class="line">[root@silen tomcat]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:25:2d:9e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.29.20/18 brd 172.17.63.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314959856sec preferred_lft 314959856sec</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:d0:a4:c4:67 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># docker新加的网卡ip</span></span></span><br><span class="line">105: veth60e3fe6@if104: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default</span><br><span class="line">    link/ether 76:35:f8:b4:eb:db brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 查看docker容器网卡ip</span></span></span><br><span class="line">[root@silen tomcat]# docker exec -it a7bcafef5fc7 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 容器网卡IP， 使用evth-pair技术与主机新加的网卡连接</span></span></span><br><span class="line">104: eth0@if105: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default</span><br><span class="line">    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
</li>
<li><p>容器之间通讯</p>
<p><img src="https://i.loli.net/2021/06/02/1nwjsyBdtTxRbDL.png" alt="image-20210602094123964"></p>
<p>​    综上，每启动一个docker容器，docker就会新增一对网卡，一个在主机上，一个在容器内，网卡间通过evth-pair技术通讯，这样主机本身可以看作一个路由器，容器1发送的数据经由路由器分配到容器2进行接收，路由器就是docker服务网卡docker0.</p>
<p>容器删除后网卡对也会被删除。</p>
</li>
</ul>
<h4 id="2-–link-不建议使用"><a href="#2-–link-不建议使用" class="headerlink" title="(2) –link(不建议使用)"></a>(2) –link(不建议使用)</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动两个tomcat容器 tomcat01和tomcat02</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用容器名 直接ping ping不通</span></span><br><span class="line">[root@silen ~]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">ping: tomcat01: Name or service not known</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解决</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用--<span class="built_in">link</span>进行容器连接</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建并运行tomcat03,与tomcat02连接</span></span><br><span class="line">[root@silen ~]# docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">0563f23bdf9efbc354de1496844e82f3483575ab205233b462b555ab570c5010</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用tomcat03 ping tomcat02,ping得通</span></span><br><span class="line">[root@silen ~]# docker exec -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.18.0.2): icmp_seq=1 ttl=64 time=0.133 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.2): icmp_seq=2 ttl=64 time=0.102 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.2): icmp_seq=3 ttl=64 time=0.085 ms</span><br><span class="line">64 bytes from tomcat02 (172.18.0.2): icmp_seq=4 ttl=64 time=0.079 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用tomcat02 ping tomcat03,ping不通</span></span><br><span class="line">[root@silen ~]# docker exec -it tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Name or service not known</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">原因</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入tomcat03容器，查看hosts文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以发现--<span class="built_in">link</span>在host文件中将tomcat的ip和容器名进行了映射</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">所以用tomcat03 ping tomcat02可以ping通</span></span><br><span class="line">[root@silen ~]# docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.18.0.2      tomcat02 55b3209b3868</span><br><span class="line">172.18.0.7      0563f23bdf9e</span><br><span class="line">[root@silen ~]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入tomcat02容器，查看hosts文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">并没有进行映射配置，所以ping不同tomcat03</span></span><br><span class="line">[root@silen ~]# docker exec -it tomcat02 cat /etc/hosts</span><br><span class="line">127.0.0.1       localhost</span><br><span class="line">::1     localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0 ip6-localnet</span><br><span class="line">ff00::0 ip6-mcastprefix</span><br><span class="line">ff02::1 ip6-allnodes</span><br><span class="line">ff02::2 ip6-allrouters</span><br><span class="line">172.18.0.2      55b3209b3868</span><br><span class="line">[root@silen ~]#</span><br></pre></td></tr></table></figure>



<h4 id="3-自定义网络"><a href="#3-自定义网络" class="headerlink" title="(3) 自定义网络"></a>(3) 自定义网络</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有docker网络</span></span><br><span class="line">[root@silen ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">33ecad835fb1   bridge    bridge    local</span><br><span class="line">b6a54d44bb55   host      host      local</span><br><span class="line">b29da0803ce1   none      null      local</span><br><span class="line">[root@silen ~]#</span><br></pre></td></tr></table></figure>

<p><strong>docker网络模式</strong></p>
<blockquote>
<p>bridge: 桥接（默认，自定义网络也使用桥接模式）</p>
</blockquote>
<blockquote>
<p>none：不配置网络</p>
</blockquote>
<blockquote>
<p>host：和宿主机共享网络</p>
</blockquote>
<blockquote>
<p>container：容器网络连通（使用较少）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建自定义网络</span></span><br><span class="line">docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line"></span><br><span class="line">[root@silen ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME      DRIVER    SCOPE</span><br><span class="line">33ecad835fb1   bridge    bridge    local</span><br><span class="line">b6a54d44bb55   host      host      local</span><br><span class="line">ce415bf10005   mynet     bridge    local</span><br><span class="line">b29da0803ce1   none      null      local</span><br><span class="line"></span><br><span class="line">[root@silen ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;ce415bf10005a538042d177089ad3afdd317eda714f0e2d574fa43f1bf138a0d&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-06-07T20:39:28.30679332+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建容器tomcat-net-01、tomcat-net-02，使用自定义网络</span></span><br><span class="line">[root@silen ~]# docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">d64bdf7d5ae9c43b5b88fe1f7838e9428b7b050320b5c46341da60f53f26c21c</span><br><span class="line">[root@silen ~]# docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">4ba170044dda83d86f2e5328240003cb623345309b4f902eac999d553e73cfae</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次检查自定义网络</span></span><br><span class="line">[root@silen ~]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;ce415bf10005a538042d177089ad3afdd317eda714f0e2d574fa43f1bf138a0d&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-06-07T20:39:28.30679332+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;4ba170044dda83d86f2e5328240003cb623345309b4f902eac999d553e73cfae&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;18f37fa3cd7f5971c0c75acba897d4032f514cb01f891299d792848cf49230ec&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;d64bdf7d5ae9c43b5b88fe1f7838e9428b7b050320b5c46341da60f53f26c21c&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;3d10542e103d075661f8bb5a720ac528fae5f95d6592ed0b98a02aecce33ac26&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器之间相互ping，可以ping通</span></span><br><span class="line">[root@silen ~]# docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.079 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.090 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=3 ttl=64 time=0.084 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 0.079/0.084/0.090/0.008 ms</span><br><span class="line">[root@silen ~]# docker exec -it tomcat-net-02 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.057 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.094 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.079 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 0.057/0.076/0.094/0.018 ms</span><br><span class="line">[root@silen ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>好处</strong>：不同集群使用不同网络，保证集群是安全和健康的</p>
<h4 id="4-网络连通"><a href="#4-网络连通" class="headerlink" title="(4) 网络连通"></a>(4) 网络连通</h4><blockquote>
<p>docker network connect 自定义网络名 容器名</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器tomcat01信息（默认使用网络docker0）</span></span><br><span class="line">[root@silen ~]# docker inspect a7bcafef5fc7</span><br><span class="line"> ...</span><br><span class="line">                     &quot;Gateway&quot;: &quot;172.18.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.18.0.4&quot;,</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器tomcat-net-01信息</span></span><br><span class="line">[root@silen ~]# docker inspect d64bdf7d5ae9</span><br><span class="line">...</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;192.168.0.2&quot;,</span><br><span class="line">...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">两者处于不同网段下，故不能ping通</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连通方法</span></span><br><span class="line">[root@silen ~]# docker network connect mynet tomcat01</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看mynet信息，发现tomcat01加如mynet网络下</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一个容器，两个ip(公网ip,私网ip)</span></span><br><span class="line">[root@silen ~]# docker inspect mynet</span><br><span class="line">[</span><br><span class="line">    ...</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;4ba170044dda83d86f2e5328240003cb623345309b4f902eac999d553e73cfae&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;18f37fa3cd7f5971c0c75acba897d4032f514cb01f891299d792848cf49230ec&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;a7bcafef5fc79bfa45576ff11ff208518ad99e6b83df5d0684a9938afbf2a9b7&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;c62a0bcb3844c494681843a8b0941f6385013e0cb1fee3910a3cf0dbd97f121c&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;d64bdf7d5ae9c43b5b88fe1f7838e9428b7b050320b5c46341da60f53f26c21c&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;3d10542e103d075661f8bb5a720ac528fae5f95d6592ed0b98a02aecce33ac26&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@silen ~]# docker exec -it tomcat01 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.080 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.075 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.083 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 0.075/0.079/0.083/0.008 ms</span><br><span class="line">[root@silen ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<hr>
<h3 id="八、-部署redis集群"><a href="#八、-部署redis集群" class="headerlink" title="八、 部署redis集群"></a>八、 部署redis集群</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建网卡</span></span><br><span class="line">[root@silen ~]# docker network create redis --subnet 172.38.0.0/16</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过脚本创建六个redis配置</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt;EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动6个redis节点</span></span><br><span class="line">for port in $(seq 1 6);\</span><br><span class="line">do \</span><br><span class="line">docker run -p 637$&#123;port&#125;:6379 -p 1637$&#123;port&#125;:16379 --name redis-$&#123;port&#125; \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/data:/data/ \</span><br><span class="line">-v /mydata/redis/node-$&#123;port&#125;/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.1$&#123;port&#125; redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf; \</span><br><span class="line">done</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建集群</span></span><br><span class="line">[root@silen conf]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: 890f9002525decb2a337b5b9fd3bd3009bdd7ef6 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: ceee28641eae2b8c1ff52ed8d04864cde3ad4311 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 663cbd57f2de47a0608282654d5584dfa93ee60f 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: ec27079fce3dad908af8b8ea822fe1440bd677d0 172.38.0.14:6379</span><br><span class="line">   replicates 663cbd57f2de47a0608282654d5584dfa93ee60f</span><br><span class="line">S: 8c017e971ba661387b4f7b9f4c6b791d76baa5df 172.38.0.15:6379</span><br><span class="line">   replicates 890f9002525decb2a337b5b9fd3bd3009bdd7ef6</span><br><span class="line">S: 65881abaef6139d46b38ca0a6ec7834c38169ad7 172.38.0.16:6379</span><br><span class="line">   replicates ceee28641eae2b8c1ff52ed8d04864cde3ad4311</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">..</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: 890f9002525decb2a337b5b9fd3bd3009bdd7ef6 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: ec27079fce3dad908af8b8ea822fe1440bd677d0 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 663cbd57f2de47a0608282654d5584dfa93ee60f</span><br><span class="line">S: 65881abaef6139d46b38ca0a6ec7834c38169ad7 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates ceee28641eae2b8c1ff52ed8d04864cde3ad4311</span><br><span class="line">M: 663cbd57f2de47a0608282654d5584dfa93ee60f 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">M: ceee28641eae2b8c1ff52ed8d04864cde3ad4311 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 8c017e971ba661387b4f7b9f4c6b791d76baa5df 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 890f9002525decb2a337b5b9fd3bd3009bdd7ef6</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动集群，查看集群信息</span></span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:494</span><br><span class="line">cluster_stats_messages_pong_sent:493</span><br><span class="line">cluster_stats_messages_sent:987</span><br><span class="line">cluster_stats_messages_ping_received:488</span><br><span class="line">cluster_stats_messages_pong_received:494</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:987</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看节点</span></span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">ec27079fce3dad908af8b8ea822fe1440bd677d0 172.38.0.14:6379@16379 slave 663cbd57f2de47a0608282654d5584dfa93ee60f 0 1623081119000 4 connected</span><br><span class="line">65881abaef6139d46b38ca0a6ec7834c38169ad7 172.38.0.16:6379@16379 slave ceee28641eae2b8c1ff52ed8d04864cde3ad4311 0 1623081119483 6 connected</span><br><span class="line">663cbd57f2de47a0608282654d5584dfa93ee60f 172.38.0.13:6379@16379 master - 0 1623081120585 3 connected 10923-16383</span><br><span class="line">ceee28641eae2b8c1ff52ed8d04864cde3ad4311 172.38.0.12:6379@16379 master - 0 1623081119483 2 connected 5461-10922</span><br><span class="line">8c017e971ba661387b4f7b9f4c6b791d76baa5df 172.38.0.15:6379@16379 slave 890f9002525decb2a337b5b9fd3bd3009bdd7ef6 0 1623081120484 5 connected</span><br><span class="line">890f9002525decb2a337b5b9fd3bd3009bdd7ef6 172.38.0.11:6379@16379 myself,master - 0 1623081119000 1 connected 0-5460</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">存入一个值</span></span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [15495] located at 172.38.0.13:6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">回到主机，停掉172.38.0.13对应的redis服务</span></span><br><span class="line">[root@silen ~]# docker stop 4a57bb4be427</span><br><span class="line">4a57bb4be427</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入容器，进入redis服务，取值</span></span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [15495] located at 172.38.0.14:6379</span></span><br><span class="line">&quot;b&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看节点</span></span><br><span class="line">172.38.0.14:6379&gt; cluster nodes</span><br><span class="line">ceee28641eae2b8c1ff52ed8d04864cde3ad4311 172.38.0.12:6379@16379 master - 0 1623081361159 2 connected 5461-10922</span><br><span class="line">8c017e971ba661387b4f7b9f4c6b791d76baa5df 172.38.0.15:6379@16379 slave 890f9002525decb2a337b5b9fd3bd3009bdd7ef6 0 1623081362663 5 connected</span><br><span class="line">ec27079fce3dad908af8b8ea822fe1440bd677d0 172.38.0.14:6379@16379 myself,master - 0 1623081362000 7 connected 10923-16383</span><br><span class="line">663cbd57f2de47a0608282654d5584dfa93ee60f 172.38.0.13:6379@16379 master,fail - 1623081241434 1623081240826 3 connected</span><br><span class="line">65881abaef6139d46b38ca0a6ec7834c38169ad7 172.38.0.16:6379@16379 slave ceee28641eae2b8c1ff52ed8d04864cde3ad4311 0 1623081360557 6 connected</span><br><span class="line">890f9002525decb2a337b5b9fd3bd3009bdd7ef6 172.38.0.11:6379@16379 master - 0 1623081362162 1 connected 0-5460</span><br><span class="line">172.38.0.14:6379&gt; </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">集群搭建成功</span></span><br></pre></td></tr></table></figure>



<hr>
<h4 id="参考-鸣谢"><a href="#参考-鸣谢" class="headerlink" title="参考&amp;鸣谢"></a>参考&amp;鸣谢</h4><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1og4y1q7M4?from=search&seid=582149756946795200">【狂神说Java】Docker最新超详细版教程通俗易懂</a></p>

    </div>
</article>



  <script>
    //检测推送
    var pushType = "";
    var pushLink = "";
    var siteName = "Hexo";

    var ValineButton = document.getElementsByClassName("vsubmit vbtn")[0];
    //分情况推送
    if (pushType === "cp") {
      var title = siteName + "上又有新评论啦~!\n";
      function send_valine_CoolPush() {
        //获取元素信息
        var pagename = document.title;
        var wz = pagename.indexOf("|");
        var res = pagename.substring(0, wz);
        var pageurl = document.URL;
        var ptime = new Date();
        var vnick = document.getElementsByClassName("vnick vinput")[0].value;
        var vmail = document.getElementsByClassName("vmail vinput")[0].value;
        var vlink = document.getElementsByClassName("vlink vinput")[0].value;
        var veditor = document.getElementsByClassName("veditor vinput")[0].value;
        var data =
          "昵称: " +
          vnick +
          "\n\n邮箱: " +
          vmail +
          "\n\n网站地址: " +
          vlink +
          "\n\n当前页面: " +
          pagename +
          "\n\n评论内容: " +
          veditor +
          "\n\n跳转链接: " +
          pageurl +
          "\n\n评论时间: " +
          ptime.toLocaleString();
        var httpRequest = new XMLHttpRequest(); //第一步：创建需要的对象
        httpRequest.open("POST", pushLink, true); //第二步：打开连接
        httpRequest.setRequestHeader(
          "Content-type",
          "application/json"
        ); //设置请求头 注：post方式必须设置请求头（在建立连接后设置请求头）
        var payload = { "t": title, "c": data }
        httpRequest.send(JSON.stringify(payload)); //发送请求 将情头体写在send中
      }
      ValineButton.onclick = send_valine_CoolPush;
    }
  </script>
    
        <div id="footer-post-container">
    <div id="footer-post">

        <div id="nav-footer" style="display: none">
            <ul>
                
                    <li><a href="/">Home</a></li>
                
                    <li><a href="/archives/">Articles</a></li>
                
                    <li><a href="/categories/">Category</a></li>
                
                    <li><a href="/tags/">Tag</a></li>
                
                    <li><a href="/about/">About</a></li>
                
                    <li><a href="/search/">Search</a></li>
                
            </ul>
        </div>

        <div id="toc-footer" style="display: none">
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Go"><span class="toc-number">1.</span> <span class="toc-text">Docker Go</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%90%8D%E8%AF%8D%E6%A6%82%E5%BF%B5"><span class="toc-number">1.1.</span> <span class="toc-text">一、名词概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">二、Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">(1)环境准备</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.2.</span> <span class="toc-text">(2) 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8docker"><span class="toc-number">1.2.3.</span> <span class="toc-text">(3)启动docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8D%B8%E8%BD%BDdocker"><span class="toc-number">1.2.4.</span> <span class="toc-text">(4) 卸载docker</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">1.2.5.</span> <span class="toc-text">(5) 阿里云镜像加速</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81-docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.</span> <span class="toc-text">三、 docker常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.1.</span> <span class="toc-text">(1)帮助命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.2.</span> <span class="toc-text">(2)镜像命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.3.</span> <span class="toc-text">(3)容器命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.4.</span> <span class="toc-text">(4)常用其他命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.4.</span> <span class="toc-text">四、docker镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.4.1.</span> <span class="toc-text">(1)镜像是什么</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.2.</span> <span class="toc-text">(2)docker镜像加载原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%90%86%E8%A7%A3%E5%88%86%E5%B1%82"><span class="toc-number">1.4.3.</span> <span class="toc-text">(3)理解分层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-commit%E9%95%9C%E5%83%8F"><span class="toc-number">1.4.4.</span> <span class="toc-text">(4)commit镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.</span> <span class="toc-text">五、容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.1.</span> <span class="toc-text">(1)什么是容器数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.5.2.</span> <span class="toc-text">(2)使用数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%88%9D%E5%A7%8Bdockerfile"><span class="toc-number">1.5.3.</span> <span class="toc-text">(3)初始dockerfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">1.5.4.</span> <span class="toc-text">(4)数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AD%E3%80%81DockerFile"><span class="toc-number">1.6.</span> <span class="toc-text">六、DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.6.1.</span> <span class="toc-text">(1) 基本介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-dockerfile%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">1.6.2.</span> <span class="toc-text">(2) dockerfile常用指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%80%9A%E8%BF%87dockerfile%E5%88%9B%E5%BB%BAtomcat%E9%95%9C%E5%83%8F"><span class="toc-number">1.6.3.</span> <span class="toc-text">(3) 通过dockerfile创建tomcat镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.6.4.</span> <span class="toc-text">(4) 发布自己的镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%83%E3%80%81Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">1.7.</span> <span class="toc-text">七、Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E7%90%86%E8%A7%A3Docker0"><span class="toc-number">1.7.1.</span> <span class="toc-text">(1) 理解Docker0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E2%80%93link-%E4%B8%8D%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8"><span class="toc-number">1.7.2.</span> <span class="toc-text">(2) –link(不建议使用)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">1.7.3.</span> <span class="toc-text">(3) 自定义网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">1.7.4.</span> <span class="toc-text">(4) 网络连通</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%AB%E3%80%81-%E9%83%A8%E7%BD%B2redis%E9%9B%86%E7%BE%A4"><span class="toc-number">1.8.</span> <span class="toc-text">八、 部署redis集群</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E8%80%83-%E9%B8%A3%E8%B0%A2"><span class="toc-number">1.8.1.</span> <span class="toc-text">参考&amp;鸣谢</span></a></li></ol></li></ol></li></ol>
        </div>

        <div id="share-footer" style="display: none">
            <ul>
    <li><a class="icon"
           target="_blank" rel="noopener" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/&title=docker go"><i
                    class="fab fa-qq fa-lg" aria-hidden="true"></i></a></li>
    <li><a class="icon"
           target="_blank" rel="noopener" href="https://service.weibo.com/share/share.php?url=http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/&title=docker go"><i
                    class="fab fa-weibo fa-lg" aria-hidden="true"></i></a></li>
    <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/&text=docker go"><i
                    class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
    <li><a class="icon" href="mailto:?subject=docker go&body=Check out this article: http://example.com/2021/04/06/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/docker_go/"><i
                    class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
</ul>
        </div>

        <div id="actions-footer">
            <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i
                        class="fas fa-bars fa-lg"
                        aria-hidden="true"></i> Menu</a>
            <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i
                        class="fas fa-list fa-lg"
                        aria-hidden="true"></i> TOC</a>
            <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i
                        class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
            <a id="top" style="display:none" class="icon" href="#"
               onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg"
                                                                               aria-hidden="true"></i> Top
            </a>
        </div>

    </div>
</div>
    
    <footer id="footer">
  <div class="footer-top">
    &copy; 2024 <i class="fas fa-heart"></i>
    John Doe 
    <a href="http://www.beian.miit.gov.cn/" target="_blank">湘ICP备17005082号</a>
    
  </div>

  <div class="footer-bottom">
    
    <!-- tongji -->
    <script
      async
      src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"
    ></script>
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问总量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
    <br />
      本网站由
    <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank">
       又拍云 
    </a>
    提供CDN加速/云存储服务 
  </div>
</footer>

</div>
<!-- styles -->

<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.0.0/css/all.min.css">


<link rel="stylesheet" href="https://cdn.staticfile.org/justifiedGallery/3.7.0/css/justifiedGallery.min.css">

<!-- jquery -->

<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>


<script src="https://cdn.staticfile.org/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

    
<script src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>

    <script type="text/javascript">
        $(function () {
            // copy-btn HTML
            var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
            btn += '<i class="far fa-clone"></i>';
            btn += '</span>';
            // mount it!
            $(".highlight .code pre").before(btn);
            var clip = new ClipboardJS('.btn-copy', {
                target: function (trigger) {
                    return trigger.nextElementSibling;
                }
            });
            clip.on('success', function (e) {
                e.trigger.setAttribute('aria-label', "Copied!");
                e.clearSelection();
            })
        })
    </script>


<script src="/js/main.js"></script>

<!-- search -->

</body>

</html>